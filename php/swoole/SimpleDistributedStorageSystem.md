# 简单分布式存储系统

## Master, Node
Master持有所有node的信息，ip，域名，存储设备剩余容量，保存路径等。

Master负责接收客户端上传的文件，暂时保存在master机器上，给这个文件分配一个存储node（需要生成一个uid作为身份识别）， 启动一个异步的 task， 把这个文件传输到对应node。
同时把这个文件的存储信息（ node的ip，域名，uid, 保存路径, 文件md5?; 这里根据业务可以做很多事，不能写死 ）返回给客户端。
这个分配node的过程是很快的，因为传递文件到node过程是并行的。

Node负责接收Master传输而来的文件，并将其保存在指定目录（在配置文件中设置）
Node还需要支持一部分 http 协议， 这样用户才能通过web访问文件

## 是否需要数据库
Master需要接受检索指令。用数据库生成uid，保存文件信息是一个简便的办法。
而且在传输文件到node的过程中可能会失败，这时候必须把Exception保存到一个 failed queue, 类似 Laravel 实现的那样，这样就可以找原因，修复这个错误来补救。

Master的传输文件Task可能会有忙不过来的情况，这时候可以用 task queue。

Mysql 作为保存文件信息的数据库。
Redis 作为队列使用；同时可以维护一个自增的uid, 还是用mysql的auto increase?。

## 指令操作
检索，上传，覆盖，删除

## 可靠性
文件的备份问题，这个类似 某分布式K/V数据库(叫啥忘记了, 回去查查) 的算法实现; 有向时间戳(Vector?)来实现同步
这部分暂时不用管，目前搞不定，不影响使用。

## 容量问题
Master必须对所有node的剩余容量保持更新，为文件分配node的算法中，剩余存储容量应该占较大的权重。当然最先满足的是 node 可用。

这也部分解决了加入新节点的处理，假设新节点容量大，那么自动就会倾向于把文件上传到新节点。

## Node可用性
Master和node之间有持续的ping/pong问答。节点中发生的错误也应当及时传给master做记录。
问答的内容包括哪些？

## 动态新增节点
新启动一个Node之后，Node主动通知Master自己的存在，在Master中注册node

## Master挂了怎么办
设置多台Master?多台的话就有同步问题。没想好。一台Master工作，其他做备用，Working Master定时向Idle Master同步数据？这样性能会有问题吗？




